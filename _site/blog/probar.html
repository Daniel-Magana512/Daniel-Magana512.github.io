<!DOCTYPE html><html><head><head> <!-- Include Meta Tags Here --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no"><meta content='#000000' name='theme-color'/><meta name="keywords" content="Site, Template, Theme"><title>What A Theme | ¿Qué es la contabilidad y qué usos tiene?</title><!-- Open Graph general (Facebook, Pinterest & Google+) --><meta name="og:title" content="What A Theme | ¿Qué es la contabilidad y qué usos tiene?"><meta name="og:description" content="This post will guide you to install WhatATheme on your Jekyll site, follow the easy steps to set up WhatATheme."><meta name="og:image" content="https://img.freepik.com/foto-gratis/cooperacion-analista-grafico-profesional-papel-economia_1418-47.jpg?w=1060&t=st=1688575071~exp=1688575671~hmac=82df1e3fd6497152937ab4394ec47bf68a92aa93f35d160b030f216d0e776d4f"><meta name="og:image:alt" content="What A Theme | ¿Qué es la contabilidad y qué usos tiene?"><meta name="og:url" content="http://localhost:4000/blog/probar"><meta name="article:author" content="https://www.facebook.com/thedevslot"><meta name="og:site_name" content="What A Theme | ¿Qué es la contabilidad y qué usos tiene?"><meta name="og:type" content="website"> <!-- Twitter --><meta property="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="What A Theme | ¿Qué es la contabilidad y qué usos tiene?"><meta name="twitter:description" content="This post will guide you to install WhatATheme on your Jekyll site, follow the easy steps to set up WhatATheme."><meta name="twitter:site" content="@thedevslot"><meta name="twitter:creator" content="@thedevslot"><meta name="twitter:image:src" content="https://img.freepik.com/foto-gratis/cooperacion-analista-grafico-profesional-papel-economia_1418-47.jpg?w=1060&t=st=1688575071~exp=1688575671~hmac=82df1e3fd6497152937ab4394ec47bf68a92aa93f35d160b030f216d0e776d4f"> <!-- Search Engine --><meta name="description" content="This post will guide you to install WhatATheme on your Jekyll site, follow the easy steps to set up WhatATheme."><meta name="image" content="https://img.freepik.com/foto-gratis/cooperacion-analista-grafico-profesional-papel-economia_1418-47.jpg?w=1060&t=st=1688575071~exp=1688575671~hmac=82df1e3fd6497152937ab4394ec47bf68a92aa93f35d160b030f216d0e776d4f"> <!-- Schema.org for Google --><meta itemprop="name" content="What A Theme | ¿Qué es la contabilidad y qué usos tiene?"><meta name="author" content="TheDevsLot"/><meta itemprop="description" content="This post will guide you to install WhatATheme on your Jekyll site, follow the easy steps to set up WhatATheme."><meta itemprop="image" content="https://img.freepik.com/foto-gratis/cooperacion-analista-grafico-profesional-papel-economia_1418-47.jpg?w=1060&t=st=1688575071~exp=1688575671~hmac=82df1e3fd6497152937ab4394ec47bf68a92aa93f35d160b030f216d0e776d4f"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163806439-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-163806439-1'); </script><title>What A Theme</title><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script><link rel="shortcut icon" href="http://localhost:4000/assets/images/logo.png" type="image/x-icon"></head></head><body><nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar"><div class="container"> <!-- logo or branding image on left side --><div class="navbar-brand"> <a class="navbar-item" href="http://localhost:4000/"> <strong>What A Theme</strong> </a><div class="navbar-burger" data-target="navbar-menu"> <span></span> <span></span> <span></span></div></div><!-- children of navbar-menu must be navbar-start and/or navbar-end --><div class="navbar-menu has-background-black" id="navbar-menu"> <!-- navbar items | left side --> <!--<div class="navbar-start"></div>--> <!-- navbar items | right side --><div class="navbar-end"> <a class="navbar-item " href="http://localhost:4000/">HOME</a> <a class="navbar-item" href="http://localhost:4000/#about">ABOUT</a> <a class="navbar-item" href="http://localhost:4000/#contact">CONTACT</a> <a class="navbar-item " href="http://localhost:4000/blog">BLOG</a><div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link"> MORE </a><div class="navbar-dropdown has-background-black is-left"> <a href="http://localhost:4000/project" class="navbar-item has-text-grey-light "> Projects </a> <a href="http://localhost:4000/test-page" class="navbar-item has-text-grey-light "> Test Page </a> <!--<hr class="navbar-divider"> <a class="navbar-item"> Report an issue </a> --></div></div></div></div></div></nav><!-- Bulma Navbar JS --> <script> document.addEventListener('DOMContentLoaded', function () { /* Get all "navbar-burger" elements */ var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0); /* Check if there are any navbar burgers */ if ($navbarBurgers.length > 0) { /* Add a click event on each of them */ $navbarBurgers.forEach(function ($el) { $el.addEventListener('click', function () { /* Get the target from the "data-target" attribute */ var target = $el.dataset.target; var $target = document.getElementById(target); /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */ $el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script><section class="hero is-fullheight has-text-centered" id="post"><div class="hero-body"><div class="container"> <a href="/blog/probar" class="has-text-black" id="title"><h1 class="title has-text-centered is-2 has-text-weight-semibold ">¿Qué es la contabilidad y qué usos tiene?</h1></a><hr class="has-background-black"><div class="columns is-variable is-5"><div class="column is-6"><figure class="image is-16by9 has-shadow"> <img src="https://img.freepik.com/foto-gratis/cooperacion-analista-grafico-profesional-papel-economia_1418-47.jpg?w=1060&t=st=1688575071~exp=1688575671~hmac=82df1e3fd6497152937ab4394ec47bf68a92aa93f35d160b030f216d0e776d4f" alt="" id="post-image"></figure></div><div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile"><p id="description" class="content is-small has-text-weight-medium is-uppercase">This post will guide you to install WhatATheme on your Jekyll site, follow the easy steps to set up WhatATheme.</p><p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on <b>April 05, 2020</b> by <a href="https://github.com/thedevslot" target="_blank"><b class="has-text-link"><u>TheDevsLot</u></b> </a></p><p class="subtitle is-uppercase"> <i class="fas fa-tags"></i> <span class="tag is-link">how to</span> <span class="tag is-link">setup</span> <span class="tag is-link">theme</span> <span class="tag is-link">contabilidad</span></p><p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link"> 15 min </b>READ</p></div></div><div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile"><p><h1 id="introducción-a-la-contabilidad">Introducción a la contabilidad</h1><p><em>En esta actividad vamos a crear la arquitectura de la práctica 9 y 7.</em></p><p><em>Para generar la infraestructura, tenemos que estar dentro del directorio playbook y escribir <strong>ansible-playbook “nombre_plantilla”</strong>.El problema de hacerlo con ansible es que tarda mucho en generar las instancias, pero no tiene mucha dificultad.</em></p><p><em>Ahora voy a explicar el contenido de los archivos.</em></p><h2 id="para-la-arquitectura-de-la-práctica-7"><strong>Para la arquitectura de la práctica 7.</strong></h2><p>Voy a explicar el archivo de creación de la arquitectura de la práctica:</p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Este Playbook generá la arquitectura de la plantilla </span><span class="m">7</span>
  
  <span class="c1">#La conexión va a ser de forma local, solamente para crear las instancias, de manera que no voy a tener necesidad de conectarme a ellas para ejecutar comandos por eso no hay un inventario y en la conexión se hace de forma local. </span>

  <span class="na">hosts</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">connection</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="kc">false</span>

  <span class="na">tasks</span><span class="pi">:</span>

  <span class="c1">#Añadimos el archivo de las variables</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Añadimos las variables</span>
    <span class="na">ansible.builtin.include_vars</span><span class="pi">:</span>
      <span class="s">../variables/variables.yml</span>

    <span class="c1">#Aquí empezamos a crear los grupos de seguridad de cada máquina.</span>

    <span class="c1">#Para la creación de los grupos de seguridad, vamos a usar el módulo "ec2_group", una vez declarado le pasaremos el nombre del grupo , la descripción y los roles(aquí hacemos la referencia a los puertos , indicamos elementos como el puerto que queremos abrir , las condiciones de la IP que debe de cumplir para interactuar con las máquinas, el tipo de puerto, y el protocolo )</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del frontend</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>

    <span class="c1">#Los mismos pasos para el backend</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del backend</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>

<span class="c1">#Aquí creamos las instancias.</span>

<span class="c1">#Para generar las instancias vamos a usar el módulo "ec2_instance", le pasamos los siguientes parametros: el nombre de la instancia, la clave ssh, el nombre del grupo , el tipo de instancia (capacidad), y la ami. Ponemos que el estado de la máquina sea running (que significa que esté funcionando).</span>

<span class="c1">#------------------------------------------------</span>
<span class="c1">#Creación del frontend</span>
<span class="c1">#-----------------------------------------------</span>

<span class="c1">#La última linea "register: ec2" es para que tener un registro de la máquina que luego usaremos para asociar la ip elástica, por eso la otra instancia no se tener esta línea.</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del frontend</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>
    <span class="na">register</span><span class="pi">:</span> <span class="s">ec2</span>

<span class="c1">#------------------------------------------------------</span>
<span class="c1">#Creación backend</span>
<span class="c1">#------------------------------------------------------</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del backend</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>

<span class="c1">#Asociamos la  la ip elásticas al frontend</span>
<span class="c1">#-----------------------------------------------------------</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Mostramos el contenido de la variable ec2</span>
    <span class="na">debug</span><span class="pi">:</span>
      <span class="na">msg</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ec2:</span><span class="nv"> </span><span class="s">"</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear una nueva IP elástica y asociar a la instancia</span>
    <span class="na">ec2_eip</span><span class="pi">:</span>
      <span class="na">device_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">register</span><span class="pi">:</span> <span class="s">eip</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Mostrar la IP elástica</span>
    <span class="na">debug</span><span class="pi">:</span>
      <span class="na">msg</span><span class="pi">:</span> <span class="s2">"</span><span class="s">La</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">elástica</span><span class="nv"> </span><span class="s">es:</span><span class="nv"> </span><span class="s">"</span>
</code></pre></div></div><p>El archivo de las variables es el siguiente:</p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Variables para crear el frontend, grupo de seguridad...</span>
<span class="na">ec2_security_group_frontend</span><span class="pi">:</span> <span class="s">sg_frontend</span>
<span class="na">ec2_security_group_description_frontend</span><span class="pi">:</span> <span class="s">Grupo de seguridad del frontend</span>
<span class="na">ec2_instance_name_frontend</span><span class="pi">:</span> <span class="s">frontend</span>

<span class="c1">#Variables para crear el backend, grupo de seguridad...</span>
<span class="na">ec2_security_group_backend</span><span class="pi">:</span> <span class="s">sg_backend</span>
<span class="na">ec2_security_group_description_backend</span><span class="pi">:</span> <span class="s">Grupo de seguridad del backend</span>
<span class="na">ec2_instance_name_backend</span><span class="pi">:</span> <span class="s">backend</span>
<span class="c1">#Variables puertos</span>
<span class="na">port_ssh</span><span class="pi">:</span> <span class="m">22</span>
<span class="na">port_http</span><span class="pi">:</span> <span class="m">80</span>
<span class="na">port_https</span><span class="pi">:</span> <span class="m">443</span>
<span class="na">port_mysql</span><span class="pi">:</span> <span class="m">3306</span>

<span class="c1">#Variables que van a tener todas las instancias</span>
<span class="na">ec2_image</span><span class="pi">:</span> <span class="s">ami-06878d265978313ca</span>
<span class="na">ec2_instance_type</span><span class="pi">:</span> <span class="s">t2.small</span>
<span class="na">ec2_key_name</span><span class="pi">:</span> <span class="s">vockey</span>
</code></pre></div></div><p><strong>Importante</strong>, para destruir la infraestructura de la práctica7.</p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Playbook para eliminar un grupo de seguridad y una instancia EC2 en AWS</span>

  <span class="c1">#La conexión va a ser de forma local, solamente para crear las instancias, de manera que no voy a tener necesidad de conectarme a ellas para ejecutar comandos por eso no hay un inventario y en la conexión se hace de forma local.</span>

  <span class="na">hosts</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">connection</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="kc">false</span>


  <span class="na">tasks</span><span class="pi">:</span>

  <span class="c1">#Añadimos las variables de los recursos de la infraestructura.</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Añadimos las variables</span>
      <span class="na">ansible.builtin.include_vars</span><span class="pi">:</span>
        <span class="s">../variables/variables.yml</span>

<span class="c1">#Obtenemos Pasos para eliminar la ip elástica</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Obtener el id de instancia a partir del nombre</span>
      <span class="na">ec2_instance_info</span><span class="pi">:</span>
        <span class="na">filters</span><span class="pi">:</span>
          <span class="s2">"</span><span class="s">tag:Name"</span><span class="err">:</span> <span class="s2">"</span><span class="s">"</span>
          <span class="s2">"</span><span class="s">instance-state-name"</span><span class="err">:</span> <span class="s2">"</span><span class="s">running"</span>
      <span class="na">register</span><span class="pi">:</span> <span class="s">ec2</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Desasociar de IP elástica de la instancia EC2</span>
      <span class="na">ec2_eip</span><span class="pi">:</span>
        <span class="na">device_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">absent</span>


<span class="c1">#Ahora llegamos a la parte de eliminar las instancias.</span>

<span class="c1">#Para ello usaremos el módulo ec2_instance, le pasamos el nombre de la instancia y de estado pondremos absent (para indicarle que queremos borrarlo.)</span>


    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Eliminar la instancia frontend</span>
      <span class="na">ec2_instance</span><span class="pi">:</span>
        <span class="na">filters</span><span class="pi">:</span>
          <span class="s2">"</span><span class="s">tag:Name"</span><span class="err">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">absent</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Eliminar la instancia backend</span>
      <span class="na">ec2_instance</span><span class="pi">:</span>
        <span class="na">filters</span><span class="pi">:</span>
          <span class="s2">"</span><span class="s">tag:Name"</span><span class="err">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">absent</span>

<span class="c1">#Ahora vamos a eliminar los grupos de seguridad, para ello usaremos el módulo ec2_group, le pasaremos el nombre del grupo y que tenga el estado absent.</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Eliminar el grupo de seguridad frontend</span>
      <span class="na">ec2_group</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">absent</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Eliminar el grupo de seguridad backend</span>
      <span class="na">ec2_group</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">absent</span>
</code></pre></div></div><h2 id="para-la-arquitectura-de-la-práctica-9"><strong>Para la arquitectura de la práctica 9.</strong></h2><p>Voy a explicar la plantilla9.yml, el contenido que tiene es el siguiente:</p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Este Playbook generá la arquitectura de la plantilla </span><span class="m">9</span>

  <span class="c1">#La conexión va a ser de forma local, solamente para crear las instancias, de manera que no voy a tener necesidad de conectarme a ellas para ejecutar comandos por eso no hay un inventario y en la conexión se hace de forma local.</span>

  <span class="na">hosts</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">connection</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="kc">false</span>


  <span class="na">tasks</span><span class="pi">:</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Añadimos las variables</span>
    <span class="na">ansible.builtin.include_vars</span><span class="pi">:</span>
      <span class="s">../variables/variables.yml</span>

    <span class="c1">#Para la creación de los grupos de seguridad, vamos a usar el módulo "ec2_group", una vez declarado le pasaremos el nombre del grupo , la descripción y los roles(aquí hacemos la referencia a los puertos , indicamos elementos como el puerto que queremos abrir , las condiciones de la IP que debe de cumplir para interactuar con las máquinas, el tipo de puerto, y el protocolo )</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del balanceador</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del frontend</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
  
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del nfs</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear un grupo de seguridad del backend</span>
    <span class="na">ec2_group</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">rules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>
      <span class="pi">-</span> <span class="na">proto</span><span class="pi">:</span> <span class="s">tcp</span>
        <span class="na">from_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">to_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">cidr_ip</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>


<span class="c1">#Para generar las instancias vamos a usar el módulo "ec2_instance", le pasamos los siguientes parametros: el nombre de la instancia, la clave ssh, el nombre del grupo , el tipo de instancia (capacidad), y la ami. Ponemos que el estado de la máquina sea running (que significa que esté funcionando).</span>

<span class="c1">#La última linea "register: ec2" es para que tener un registro de la máquina que luego usaremos para asociar la ip elástica, por eso la otra instancia no se tener esta línea.</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del balanceador</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>
    <span class="na">register</span><span class="pi">:</span> <span class="s">ec2</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del frontend01</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del frontend02</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del nfs</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>


  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear instancia del backend</span>
    <span class="na">ec2_instance</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">key_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">security_group</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">instance_type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">image_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="s">running</span>


<span class="c1">#Creamos,asociamos y mostramos la ip elástica la ip elástica</span>
<span class="c1">#--------------------------------</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Mostramos el contenido de la variable ec2</span>
    <span class="na">debug</span><span class="pi">:</span>
      <span class="na">msg</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ec2:</span><span class="nv"> </span><span class="s">"</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Crear una nueva IP elástica y asociar a la instancia</span>
    <span class="na">ec2_eip</span><span class="pi">:</span>
      <span class="na">device_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">register</span><span class="pi">:</span> <span class="s">eip</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Mostrar la IP elástica</span>
    <span class="na">debug</span><span class="pi">:</span>
      <span class="na">msg</span><span class="pi">:</span> <span class="s2">"</span><span class="s">La</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">elástica</span><span class="nv"> </span><span class="s">es:</span><span class="nv"> </span><span class="s">"</span>

</code></pre></div></div><p>El archivo de las variables es el siguiente:</p><div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Variables para crear el balanceador, grupo de seguridad...</span>
<span class="na">ec2_security_group_balancer</span><span class="pi">:</span> <span class="s">sg_balanceador</span>
<span class="na">ec2_security_group_description_balancer</span><span class="pi">:</span> <span class="s">Grupo de seguridad del balanceador</span>
<span class="na">ec2_instance_name_balancer</span><span class="pi">:</span> <span class="s">balanceador</span>

<span class="c1">#Variables para crear el frontend, grupo de seguridad...</span>
<span class="na">ec2_security_group_frontend</span><span class="pi">:</span> <span class="s">sg_frontend</span>
<span class="na">ec2_security_group_description_frontend</span><span class="pi">:</span> <span class="s">Grupo de seguridad del frontend</span>
<span class="na">ec2_instance_name_frontend</span><span class="pi">:</span> <span class="s">frontend01</span>
<span class="na">ec2_instance_name_frontend02</span><span class="pi">:</span> <span class="s">frontend02</span>

<span class="c1">#Variables para crear el nfs, grupo de seguridad...</span>
<span class="na">ec2_security_group_nfs</span><span class="pi">:</span> <span class="s">sg_nfs</span>
<span class="na">ec2_security_group_description_nfs</span><span class="pi">:</span> <span class="s">Grupo de seguridad del nfs</span>
<span class="na">ec2_instance_name_nfs</span><span class="pi">:</span> <span class="s">nfs</span>
  
<span class="c1">#Variables para crear el backend, grupo de seguridad...</span>
<span class="na">ec2_security_group_backend</span><span class="pi">:</span> <span class="s">sg_backend</span>
<span class="na">ec2_security_group_description_backend</span><span class="pi">:</span> <span class="s">Grupo de seguridad del backend</span>
<span class="na">ec2_instance_name_backend</span><span class="pi">:</span> <span class="s">backend</span>

<span class="c1">#Variables que van a tener todas las instancias</span>
<span class="na">ec2_image</span><span class="pi">:</span> <span class="s">ami-06878d265978313ca</span>
<span class="na">ec2_instance_type</span><span class="pi">:</span> <span class="s">t2.small</span>
<span class="na">ec2_key_name</span><span class="pi">:</span> <span class="s">vockey</span>

<span class="c1">#Variables de puertos</span>
<span class="na">port_ssh</span><span class="pi">:</span> <span class="m">22</span>
<span class="na">port_http</span><span class="pi">:</span> <span class="m">80</span>
<span class="na">port_https</span><span class="pi">:</span> <span class="m">443</span>
<span class="na">port_nfs</span><span class="pi">:</span> <span class="m">2049</span>
<span class="na">port_mysql</span><span class="pi">:</span> <span class="m">3306</span>
</code></pre></div></div><p>Para eliminar las instancias usaremos el archivo llamado “plantilla9_eliminar.yml” su contenido es el siguiente:</p><h2 id="yml">```yml</h2><ul><li><p>name: Playbook para eliminar un grupo de seguridad y una instancia EC2 en AWS</p><p>#La conexión va a ser de forma local, solamente para crear las instancias, de manera que no voy a tener necesidad de conectarme a ellas para ejecutar comandos por eso no hay un inventario y en la conexión se hace de forma local.</p><p>hosts: localhost connection: local gather_facts: false</p><p>tasks:</p><ul><li>name: Añadimos las variables ansible.builtin.include_vars: ../variables/variables.yml</li></ul></li></ul><p>#Pasos para liberar la ip elástica</p><ul><li><p>name: Obtener el id de instancia a partir del nombre ec2_instance_info: filters: “tag:Name”: “” “instance-state-name”: “running” register: ec2</p></li><li><p>name: Desasociar de IP elástica de la instancia EC2 ec2_eip: device_id: “” state: absent</p></li></ul><p>#——————————————————————–</p><p>#Ahora llegamos a la parte de eliminar las instancias.</p><p>#Para ello usaremos el módulo ec2_instance, le pasamos el nombre de la instancia y de estado pondremos absent (para indicarle que queremos borrarlo.)</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- name: Eliminar la instancia balanceador
  ec2_instance:
    filters:
      "tag:Name": ""
    state: absent

- name: Eliminar la instancia frontend 01
  ec2_instance:
    filters:
      "tag:Name": ""
    state: absent

- name: Eliminar la instancia frontend02
  ec2_instance:
    filters:
      "tag:Name": ""
    state: absent

- name: Eliminar la instancia backend
  ec2_instance:
    filters:
      "tag:Name": ""
    state: absent


- name: Eliminar la instancia nfs
  ec2_instance:
    filters:
      "tag:Name": ""
    state: absent
</code></pre></div></div><p>#Ahora vamos a eliminar los grupos de seguridad, para ello usaremos el módulo ec2_group, le pasaremos el nombre del grupo y que tenga el estado absent.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- name: Eliminar el grupo de seguridad del balanceador
  ec2_group:
    name: ""
    state: absent

- name: Eliminar el grupo de seguridad frontend01
  ec2_group:
    name: ""
    state: absent

- name: Eliminar el grupo de seguridad frontend02
  ec2_group:
    name: ""
    state: absent

- name: Eliminar el grupo de seguridad backend
  ec2_group:
    name: ""
    state: absent
  
- name: Eliminar el grupo de seguridad nfs
  ec2_group:
    name: ""
    state: absent
</code></pre></div></div></p></div><div class="disqus-comments" id="disqus_thread"></div></div></div></section><footer id="footer"> <!--Footer Button--><div class="container has-text-centered has-background-grey-darker" id="backtotop"> <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a></div><!--Footer Main Section--><div class="has-background-grey-darker"><div class="container columns"> <!--Name Section--><div class="column has-text-left-desktop has-text-centered-mobile"> <a href="http://localhost:4000/#about"><div class="columns"><div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet"><figure class="image is-64x64"> <img class="is-rounded" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png"></figure></div><div class="column is-marginless"><h5 class="has-text-grey-lighter">TheDevsLot</h5><div class="content has-text-grey"><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse ege...</p></div></div></div></a></div><!--Link Section--><div class="column has-text-white"><h3>More Links</h3><li> <a href="http://localhost:4000/test-page">Test Page</a></li><li> <a target="_blank" href="http://localhost:4000/feed.xml">Subscribe via RSS</a></li></div><!--Blog-post Section--><div class="column has-text-white"><h3>Recent Posts</h3><li> <a href="http://localhost:4000/blog/sample-post">Sample Post</a></li><li> <a href="http://localhost:4000/blog/how-to-install-whatatheme">How to Install and use WhatATheme?</a></li><li> <a href="http://localhost:4000/blog/what-is-jekyll-how-to-use-it">What is Jekyll? How to use it?</a></li></div></div></div><div class="has-background-black has-text-centered has-text-white" id="credits"> <i class="far fa-copyright"></i> 2023 | <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> - A Theme made with <i class="fas fa-heart has-text-danger"></i> by <a href="https://www.twitter.com/thedevslot" target="_blank" rel="noopener noreferrer">TheDevsLot</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a></div></footer></body><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://thedevslot.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></html>
